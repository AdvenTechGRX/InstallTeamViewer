$msi_url = "http://glpi-cds.adventiel.com/download/TeamViewer_Host.msi"
$configuration_id = "635e8wt"
$api_token = "15904506-np5jat32OOUzEt9mWPh9"
$base_path = "$($pwd.drive.name):\TeamViewer_Install"
New-Item $base_path -type directory -Force


$tv_msi_path = "$base_path\TeamViewer_Host-idc$configuration_id.msi"



$MyApp = Get-WmiObject -Class Win32_Product | Where-Object{$_.Name -like "TeamViewer*"}
if (!($MyApp -eq $null)) {
    $MyApp.Uninstall() 
}

Stop-process -name TeamViewer -Force
echo "Downloading TeamViewer MSI"
[Net.ServicePointManager]::SecurityProtocol = 'Tls11,Tls12'
#Invoke-WebRequest -Uri $msi_url -OutFile $tv_msi_path

$INSTALLED = Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* |  Select-Object DisplayName, UninstallString
$INSTALLED += Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, UninstallString
$INSTALLED | ?{ $_.DisplayName -ne $null } | sort-object -Property DisplayName -Unique | Format-Table -AutoSize
$SEARCH = 'TeamViewer'
$RESULT =$INSTALLED | ?{ $_.DisplayName -ne $null } | Where-Object {$_.DisplayName -match $search } 
$RESULT


if ($RESULT.uninstallstring -like "msiexec*") {
$ARGS=(($RESULT.UninstallString -split ' ')[1] -replace '/I','/X ') + ' /q'
Start-Process msiexec.exe -ArgumentList $ARGS -Wait
} else {
Start-Process $RESULT.UninstallString -ArgumentList "/S" -Wait
}



echo "installing TV"
msiexec.exe /i C:\TeamViewer_Install\TeamViewer_Host-idc635e8wt.msi /qn APITOKEN=15904506-np5jat32OOUzEt9mWPh9  CUSTOMCONFIGID=635e8wt ASSIGNMENTOPTIONS="--grant-easy-access"




# SIG # Begin signature block
# MIIR2wYJKoZIhvcNAQcCoIIRzDCCEcgCAQExCzAJBgUrDgMCGgUAMGkGCisGAQQB
# gjcCAQSgWzBZMDQGCisGAQQBgjcCAR4wJgIDAQAABBAfzDtgWUsITrck0sYpfvNR
# AgEAAgEAAgEAAgEAAgEAMCEwCQYFKw4DAhoFAAQUABqxsvKAb0cq7Df4feonv/iS
# yiiggg1BMIIDBjCCAe6gAwIBAgIQEgzG+6BUR5pKmdqmt6Qw6DANBgkqhkiG9w0B
# AQsFADAbMRkwFwYDVQQDDBBBVEEgQXV0aGVudGljb2RlMB4XDTIyMDMyMzEwMTUz
# NloXDTIzMDMyMzEwMzUzNlowGzEZMBcGA1UEAwwQQVRBIEF1dGhlbnRpY29kZTCC
# ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAM/RacQmwnV5f8OnXVYaOte6
# dEfOF5naStA5SbB5NpELmIVx7397YyZthQiPup7l3ZQjnlGxmFBPbxJEAS/Pdd13
# sekgbioIzEaAjEPFk1k8qiC+uFO4K9hgAY4vxpvqCyi013zPGTDjBj2xQWQ5Y3P5
# x6Dmj4lFPI3njJ69MtKiH+0oL8ww46daMjPZe0B/HNIhE+ks9PvTgXSZlTCuLKdf
# FdBrKj970et+Tjww61yldVjGFi77BtabUPGVzNpLK1HSNgCVJWXkDjUUlUt3MFBZ
# JH34FPamhROosH1yI/4NoFwbvC3ngj4pklztpCA1r2x6DWbffyf/Zk4oUfwujeEC
# AwEAAaNGMEQwDgYDVR0PAQH/BAQDAgeAMBMGA1UdJQQMMAoGCCsGAQUFBwMDMB0G
# A1UdDgQWBBRoEj/Ue7rUz5LDsHuYzSygfYCQpjANBgkqhkiG9w0BAQsFAAOCAQEA
# tQbxwPYd3FGM2ziNirdAE3VgKaeRUpp3duJk16uABE0NhXmt2fkrUrklG0vYfnh1
# 2AT2ItFUvLa6enLtnZ/apoj4X4r56LRJ20KFOIsd1xpiWmWFzDI5ASfK5ilpU16S
# x1zQYR1NxVsZXJK5l8gGTurn7sRr6RdzGldcdoNPwqYkcX0weyXob2+nalJUw4XI
# VlwM6bZR60tXpL6XN0R8Brf6NX0tG8hhHtadEDC7Dw31aYqhz9fGUkSTb1+KRtwH
# x3U2cfGV+t+eBNP6nxCncCH6rLlERJO3+/qU1BIxvVAeoR9H3c5ZoQ25XbKd8TjE
# hFTLA3WXekdkQBwWhWDB6TCCBP4wggPmoAMCAQICEA1CSuC+Ooj/YEAhzhQA8N0w
# DQYJKoZIhvcNAQELBQAwcjELMAkGA1UEBhMCVVMxFTATBgNVBAoTDERpZ2lDZXJ0
# IEluYzEZMBcGA1UECxMQd3d3LmRpZ2ljZXJ0LmNvbTExMC8GA1UEAxMoRGlnaUNl
# cnQgU0hBMiBBc3N1cmVkIElEIFRpbWVzdGFtcGluZyBDQTAeFw0yMTAxMDEwMDAw
# MDBaFw0zMTAxMDYwMDAwMDBaMEgxCzAJBgNVBAYTAlVTMRcwFQYDVQQKEw5EaWdp
# Q2VydCwgSW5jLjEgMB4GA1UEAxMXRGlnaUNlcnQgVGltZXN0YW1wIDIwMjEwggEi
# MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDC5mGEZ8WK9Q0IpEXKY2tR1zoR
# Qr0KdXVNlLQMULUmEP4dyG+RawyW5xpcSO9E5b+bYc0VkWJauP9nC5xj/TZqgfop
# +N0rcIXeAhjzeG28ffnHbQk9vmp2h+mKvfiEXR52yeTGdnY6U9HR01o2j8aj4S8b
# Ordh1nPsTm0zinxdRS1LsVDmQTo3VobckyON91Al6GTm3dOPL1e1hyDrDo4s1SPa
# 9E14RuMDgzEpSlwMMYpKjIjF9zBa+RSvFV9sQ0kJ/SYjU/aNY+gaq1uxHTDCm2mC
# tNv8VlS8H6GHq756WwogL0sJyZWnjbL61mOLTqVyHO6fegFz+BnW/g1JhL0BAgMB
# AAGjggG4MIIBtDAOBgNVHQ8BAf8EBAMCB4AwDAYDVR0TAQH/BAIwADAWBgNVHSUB
# Af8EDDAKBggrBgEFBQcDCDBBBgNVHSAEOjA4MDYGCWCGSAGG/WwHATApMCcGCCsG
# AQUFBwIBFhtodHRwOi8vd3d3LmRpZ2ljZXJ0LmNvbS9DUFMwHwYDVR0jBBgwFoAU
# 9LbhIB3+Ka7S5GGlsqIlssgXNW4wHQYDVR0OBBYEFDZEho6kurBmvrwoLR1ENt3j
# anq8MHEGA1UdHwRqMGgwMqAwoC6GLGh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9z
# aGEyLWFzc3VyZWQtdHMuY3JsMDKgMKAuhixodHRwOi8vY3JsNC5kaWdpY2VydC5j
# b20vc2hhMi1hc3N1cmVkLXRzLmNybDCBhQYIKwYBBQUHAQEEeTB3MCQGCCsGAQUF
# BzABhhhodHRwOi8vb2NzcC5kaWdpY2VydC5jb20wTwYIKwYBBQUHMAKGQ2h0dHA6
# Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFNIQTJBc3N1cmVkSURUaW1l
# c3RhbXBpbmdDQS5jcnQwDQYJKoZIhvcNAQELBQADggEBAEgc3LXpmiO85xrnIA6O
# Z0b9QnJRdAojR6OrktIlxHBZvhSg5SeBpU0UFRkHefDRBMOG2Tu9/kQCZk3taaQP
# 9rhwz2Lo9VFKeHk2eie38+dSn5On7UOee+e03UEiifuHokYDTvz0/rdkd2NfI1Jp
# g4L6GlPtkMyNoRdzDfTzZTlwS/Oc1np72gy8PTLQG8v1Yfx1CAB2vIEO+MDhXM/E
# EXLnG2RJ2CKadRVC9S0yOIHa9GCiurRS+1zgYSQlT7LfySmoc0NR2r1j1h9bm/cu
# G08THfdKDXF+l7f0P4TrweOjSaH6zqe/Vs+6WXZhiV9+p7SOZ3j5NpjhyyjaW4em
# ii8wggUxMIIEGaADAgECAhAKoSXW1jIbfkHkBdo2l8IVMA0GCSqGSIb3DQEBCwUA
# MGUxCzAJBgNVBAYTAlVTMRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsT
# EHd3dy5kaWdpY2VydC5jb20xJDAiBgNVBAMTG0RpZ2lDZXJ0IEFzc3VyZWQgSUQg
# Um9vdCBDQTAeFw0xNjAxMDcxMjAwMDBaFw0zMTAxMDcxMjAwMDBaMHIxCzAJBgNV
# BAYTAlVTMRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdp
# Y2VydC5jb20xMTAvBgNVBAMTKERpZ2lDZXJ0IFNIQTIgQXNzdXJlZCBJRCBUaW1l
# c3RhbXBpbmcgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC90DLu
# S82Pf92puoKZxTlUKFe2I0rEDgdFM1EQfdD5fU1ofue2oPSNs4jkl79jIZCYvxO8
# V9PD4X4I1moUADj3Lh477sym9jJZ/l9lP+Cb6+NGRwYaVX4LJ37AovWg4N4iPw7/
# fpX786O6Ij4YrBHk8JkDbTuFfAnT7l3ImgtU46gJcWvgzyIQD3XPcXJOCq3fQDpc
# t1HhoXkUxk0kIzBdvOw8YGqsLwfM/fDqR9mIUF79Zm5WYScpiYRR5oLnRlD9lCos
# p+R1PrqYD4R/nzEU1q3V8mTLex4F0IQZchfxFwbvPc3WTe8GQv2iUypPhR3EHTyv
# z9qsEPXdrKzpVv+TAgMBAAGjggHOMIIByjAdBgNVHQ4EFgQU9LbhIB3+Ka7S5GGl
# sqIlssgXNW4wHwYDVR0jBBgwFoAUReuir/SSy4IxLVGLp6chnfNtyA8wEgYDVR0T
# AQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwEwYDVR0lBAwwCgYIKwYBBQUH
# AwgweQYIKwYBBQUHAQEEbTBrMCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5kaWdp
# Y2VydC5jb20wQwYIKwYBBQUHMAKGN2h0dHA6Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNv
# bS9EaWdpQ2VydEFzc3VyZWRJRFJvb3RDQS5jcnQwgYEGA1UdHwR6MHgwOqA4oDaG
# NGh0dHA6Ly9jcmw0LmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEFzc3VyZWRJRFJvb3RD
# QS5jcmwwOqA4oDaGNGh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEFz
# c3VyZWRJRFJvb3RDQS5jcmwwUAYDVR0gBEkwRzA4BgpghkgBhv1sAAIEMCowKAYI
# KwYBBQUHAgEWHGh0dHBzOi8vd3d3LmRpZ2ljZXJ0LmNvbS9DUFMwCwYJYIZIAYb9
# bAcBMA0GCSqGSIb3DQEBCwUAA4IBAQBxlRLpUYdWac3v3dp8qmN6s3jPBjdAhO9L
# hL/KzwMC/cWnww4gQiyvd/MrHwwhWiq3BTQdaq6Z+CeiZr8JqmDfdqQ6kw/4stHY
# fBli6F6CJR7Euhx7LCHi1lssFDVDBGiy23UC4HLHmNY8ZOUfSBAYX4k4YU1iRiSH
# Y4yRUiyvKYnleB/WCxSlgNcSR3CzddWThZN+tpJn+1Nhiaj1a5bA9FhpDXzIAbG5
# KHW3mWOFIoxhynmUfln8jA/jb7UBJrZspe6HUSHkWGCbugwtK22ixH67xCUrRwII
# fEmuE7bhfEJCKMYYVs9BNLZmXbZ0e/VWMyIvIjayS6JKldj1po5SMYIEBDCCBAAC
# AQEwLzAbMRkwFwYDVQQDDBBBVEEgQXV0aGVudGljb2RlAhASDMb7oFRHmkqZ2qa3
# pDDoMAkGBSsOAwIaBQCgeDAYBgorBgEEAYI3AgEMMQowCKACgAChAoAAMBkGCSqG
# SIb3DQEJAzEMBgorBgEEAYI3AgEEMBwGCisGAQQBgjcCAQsxDjAMBgorBgEEAYI3
# AgEVMCMGCSqGSIb3DQEJBDEWBBR+qd+3z6ffrpQOVC5rDA7lXB+0wjANBgkqhkiG
# 9w0BAQEFAASCAQDM39/jg+3PhMx2S+DG5mt/i+MY0k/1f8I3kEijHrPBXyInnYh2
# tfwxYEh+wbmrcLedDyMfK2BOhuEFICTOCCyL/Wl5kGtvuA84aBJ8MSEODDSHQmMu
# vBNOZ4UiWrRZBrhAYxxezdUeMx0kfgYfyxcbfBIV6djtTxUmc9qyz/7vLswGOujy
# 6jvC5YT2Iz8xuVqrRXlsi3twNIuJ7bjYNgFWSh3c0lQd33XCzsTB72PCEookKFPx
# 5ch81sNDpsGx0U0QUB+i9F8jGnnrvPDgTgorOwwGG4kdEognN8MfwLmzo6amjCtO
# eD1Y5PovBPzd5/w1YXG7hkXEnknL+hA4nKNVoYICMDCCAiwGCSqGSIb3DQEJBjGC
# Ah0wggIZAgEBMIGGMHIxCzAJBgNVBAYTAlVTMRUwEwYDVQQKEwxEaWdpQ2VydCBJ
# bmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5jb20xMTAvBgNVBAMTKERpZ2lDZXJ0
# IFNIQTIgQXNzdXJlZCBJRCBUaW1lc3RhbXBpbmcgQ0ECEA1CSuC+Ooj/YEAhzhQA
# 8N0wDQYJYIZIAWUDBAIBBQCgaTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwG
# CSqGSIb3DQEJBTEPFw0yMjAzMjMxMDQzMjhaMC8GCSqGSIb3DQEJBDEiBCAJm24d
# xNpIQEh0iNIEctE8VtgZ0cY9CGtnWO0oQHzHOzANBgkqhkiG9w0BAQEFAASCAQBd
# tS95PG6ZW1XzbJHBT8XVkWRZxjNXNu7yFLh5WdTxwYsklP+t0GhQ0SIllu5iJqJH
# T42PINO48xRsr6K3h9yPBiPKOdRWDjTrqESzvIfecV0jcbBIeJo6/kNgz13HtpqJ
# zcCShxwu546HlT/fDaPq59K4KiCLP/A6V4GHiPuyJHQiWBVEYDvixCVzv4RRWfkt
# Qy5XSKRYLuNhSCgmeU347ITRmvrIkRs+l+j4LVg1q0bHRxH7SyQ0BBsiXuTBtRxC
# gkKR6s7rfxiC7zPhQ+ejXVZR5hEAWLHa7wW2s5vh8uRvqAddfK7wv45T6TRMap4H
# 1uZyRaFaNTvlOcVkhes6
# SIG # End signature block
